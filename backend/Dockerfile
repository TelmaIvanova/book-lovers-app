FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --omit=dev

COPY . .

ARG PORT=80
ENV PORT=$PORT

ARG CLIENT_URL
ENV CLIENT_URL=$CLIENT_URL

ARG CONNECTION
ENV CONNECTION=$CONNECTION

ARG JWT_SECRET
ENV JWT_SECRET=$JWT_SECRET

ARG JWT_EXPIRES_IN
ENV JWT_EXPIRES_IN=$JWT_EXPIRES_IN

ARG EMAIL_USERNAME
ENV EMAIL_USERNAME=$EMAIL_USERNAME

ARG EMAIL_PASSWORD
ENV EMAIL_PASSWORD=$EMAIL_PASSWORD

ARG EMAIL_HOST
ENV EMAIL_HOST=$EMAIL_HOST

ARG EMAIL_PORT
ENV EMAIL_PORT=$EMAIL_PORT

ARG EMAIL_FROM
ENV EMAIL_FROM=$EMAIL_FROM

ARG CLOUD_NAME
ENV CLOUD_NAME=$CLOUD_NAME

ARG API_KEY
ENV API_KEY=$API_KEY

ARG API_SECRET
ENV API_SECRET=$API_SECRET

ARG ETH_RPC_URL
ENV ETH_RPC_URL=$ETH_RPC_URL

EXPOSE 80/tcp

CMD ["npm", "start"]
